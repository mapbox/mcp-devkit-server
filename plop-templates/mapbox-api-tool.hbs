import { z } from 'zod';
import { MapboxApiBasedTool } from '../MapboxApiBasedTool.js';
import type { HttpRequest } from '../../utils/types.js';
import type { CallToolResult } from '@modelcontextprotocol/sdk/types.js';
import type { ToolExecutionContext } from '../../utils/tracing.js';
import { {{pascalCase name}}InputSchema } from './{{pascalCase name}}Tool.input.schema.js';
import {
  {{pascalCase name}}OutputSchema,
  type {{pascalCase name}}Output
} from './{{pascalCase name}}Tool.output.schema.js';

/**
 * {{pascalCase name}}Tool - Mapbox API integration tool
 *
 * TODO: Provide a detailed description of what this tool does
 *
 * This tool integrates with Mapbox APIs to provide geospatial functionality.
 * It handles authentication, request formatting, and response processing
 * for Mapbox services.
 *
 * @requires MAPBOX_ACCESS_TOKEN - Valid Mapbox access token with appropriate scopes
 *
 * @example
 * ```typescript
 * const tool = new {{pascalCase name}}Tool({ httpRequest });
 * const result = await tool.run({
 *   // TODO: Add example input parameters
 * });
 * ```
 *
 * @see {@link https://docs.mapbox.com/api/} Mapbox API Documentation
 */
export class {{pascalCase name}}Tool extends MapboxApiBasedTool<
  typeof {{pascalCase name}}InputSchema,
  typeof {{pascalCase name}}OutputSchema
> {
  readonly name = '{{snakeCase name}}_tool';
  readonly description = 'TODO: Update with actual description';
  readonly annotations = {
    title: '{{pascalCase name}} Tool',
    readOnlyHint: true,
    destructiveHint: false,
    idempotentHint: true,
    openWorldHint: true
  };

  constructor({ httpRequest }: { httpRequest: HttpRequest }) {
    super({
      inputSchema: {{pascalCase name}}InputSchema,
      outputSchema: {{pascalCase name}}OutputSchema,
      httpRequest
    });
  }

  /**
   * Execute the tool logic
   * @param input - Validated input from {{pascalCase name}}InputSchema
   * @param accessToken - Mapbox access token
   * @param context - Tool execution context for tracing
   * @returns CallToolResult with structured output
   */
  protected async execute(
    input: z.infer<typeof {{pascalCase name}}InputSchema>,
    accessToken: string,
    context: ToolExecutionContext
  ): Promise<CallToolResult> {
    try {
      // TODO: Implement your Mapbox API call here

      // Example implementation:
      // const url = `${MapboxApiBasedTool.mapboxApiEndpoint}your-api-endpoint?access_token=${accessToken}`;
      //
      // const response = await this.httpRequest(url);
      //
      // if (!response.ok) {
      //   return this.handleApiError(response, 'perform operation');
      // }
      //
      // const data = (await response.json()) as {{pascalCase name}}Output;
      //
      // return {
      //   content: [{ type: 'text', text: JSON.stringify(data, null, 2) }],
      //   structuredContent: data,
      //   isError: false
      // };

      // Placeholder implementation - replace with actual API call
      return {
        content: [{
          type: 'text',
          text: JSON.stringify({
            message: 'Tool executed successfully',
            input,
            timestamp: new Date().toISOString(),
            note: 'Replace this with actual Mapbox API call'
          }, null, 2)
        }],
        isError: false
      };
    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : String(error);
      this.log('error', `${this.name}: ${errorMessage}`);

      return {
        content: [{ type: 'text', text: `Error: ${errorMessage}` }],
        isError: true
      };
    }
  }
}
